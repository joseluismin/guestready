<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gu√≠a Interactiva del Alquiler Tur√≠stico en Espa√±a</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Warm Neutral Harmony -->
    <!-- Application Structure Plan: La SPA se estructura como un panel de control din√°mico ("dashboard") centrado en el perfil del usuario. El flujo principal comienza con la selecci√≥n del actor (Propietario F√≠sica, Jur√≠dica, etc.). Esta acci√≥n filtra todo el contenido visible, presentando √∫nicamente la informaci√≥n relevante para ese perfil. Las secciones est√°n organizadas por tareas: 1) Visi√≥n General con riesgos clave, 2) Obligaciones Fiscales con visualizaciones, 3) Regulaci√≥n Auton√≥mica comparativa e interactiva, y 4) un Checklist de Cumplimiento pr√°ctico. Esta estructura se eligi√≥ para transformar un informe denso y lineal en una herramienta de consulta r√°pida y orientada a la acci√≥n, respondiendo directamente a la pregunta del usuario: "¬øQu√© me afecta a M√ç?". -->
    <!-- Visualization & Content Choices: La informaci√≥n se presenta de forma interactiva para facilitar la comprensi√≥n. Las cuant√≠as de las sanciones se visualizan en un gr√°fico de barras (Chart.js) para transmitir el riesgo de forma inmediata (Goal: Informar/Alertar). La fiscalidad se organiza en tarjetas expandibles para evitar la sobrecarga de informaci√≥n (Goal: Organizar). La comparativa de normativas auton√≥micas se realiza mediante un sistema de pesta√±as para facilitar el acceso a informaci√≥n espec√≠fica (Goal: Comparar). La secci√≥n de "Errores Frecuentes" se convierte en un checklist interactivo para que el usuario pueda autoevaluar su cumplimiento (Goal: Organizar/Actuar). Se usan bloques de texto concisos en lugar de p√°rrafos largos. Justificaci√≥n: priorizar la usabilidad y la r√°pida asimilaci√≥n de informaci√≥n compleja. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body { font-family: 'Inter', sans-serif; }
        .tab-active { border-color: #2563eb; color: #2563eb; background-color: #eff6ff; }
        .actor-btn-active { background-color: #1d4ed8; color: white; }
        .details-marker::marker { content: '‚ñ∏ '; color: #2563eb; }
        details[open] .details-marker::marker { content: '‚ñæ '; }
        .chart-container { position: relative; width: 100%; max-width: 700px; margin-left: auto; margin-right: auto; height: 320px; max-height: 400px; }
        @media (min-width: 640px) {
            .chart-container { height: 350px; }
        }
        @media (min-width: 1024px) {
            .chart-container { height: 400px; }
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <div class="container mx-auto p-4 sm:p-6 lg:p-8 max-w-7xl">

        <header class="text-center mb-8 md:mb-12">
            <h1 class="text-3xl sm:text-4xl lg:text-5xl font-bold text-slate-900">Gu√≠a Interactiva del Alquiler Tur√≠stico en Espa√±a</h1>
            <p class="mt-3 text-lg text-slate-600 max-w-3xl mx-auto">Una herramienta para entender sus obligaciones, derechos y riesgos legales. Actualizado a <span id="update-date"></span>.</p>
            <p class="mt-2 text-sm text-slate-500">Este informe no constituye asesoramiento jur√≠dico personalizado.</p>
        </header>

        <main>
            <section id="actor-selector" class="mb-8 md:mb-12">
                <div class="bg-white p-6 rounded-2xl shadow-md border border-slate-200">
                    <h2 class="text-xl font-semibold text-center text-slate-800 mb-4">Para empezar, seleccione su perfil:</h2>
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3">
                        <button data-actor="persona_fisica" class="actor-btn actor-btn-active w-full p-3 font-medium rounded-lg bg-slate-100 hover:bg-blue-100 transition-colors duration-200">üë§ Propietario Persona F√≠sica</button>
                        <button data-actor="persona_juridica" class="actor-btn w-full p-3 font-medium rounded-lg bg-slate-100 hover:bg-blue-100 transition-colors duration-200">üè¢ Propietario Persona Jur√≠dica</button>
                        <button data-actor="gran_tenedor" class="actor-btn w-full p-3 font-medium rounded-lg bg-slate-100 hover:bg-blue-100 transition-colors duration-200">üè¶ Gran Tenedor</button>
                        <button data-actor="empresa_gestora" class="actor-btn w-full p-3 font-medium rounded-lg bg-slate-100 hover:bg-blue-100 transition-colors duration-200">ü§ù Empresa de Gesti√≥n</button>
                    </div>
                </div>
            </section>
            
            <div id="content-container">
                
                <section id="general-overview" class="mb-8">
                    <h2 class="text-2xl font-bold text-slate-900 mb-4">Visi√≥n General y Riesgos Clave</h2>
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                        <p id="overview-text" class="mb-4 text-slate-700"></p>
                        <div class="grid md:grid-cols-2 gap-4">
                            <div class="bg-red-50 border-l-4 border-red-500 p-4 rounded-r-lg">
                                <h4 class="font-semibold text-red-800">Riesgo Principal: Operar sin Licencia</h4>
                                <p class="text-sm text-red-700">Es la infracci√≥n m√°s grave. Las sanciones pueden alcanzar hasta 900.000‚Ç¨ y conllevar el cese inmediato de la actividad.</p>
                            </div>
                             <div class="bg-amber-50 border-l-4 border-amber-500 p-4 rounded-r-lg">
                                <h4 class="font-semibold text-amber-800">Riesgo Fiscal: Declaraci√≥n Incorrecta</h4>
                                <p class="text-sm text-amber-700">No declarar los ingresos o aplicar incorrectamente el IVA puede acarrear inspecciones y sanciones significativas de la AEAT.</p>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="fiscalidad" class="mb-8">
                    <h2 class="text-2xl font-bold text-slate-900 mb-4">Sus Obligaciones Fiscales</h2>
                     <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                        <p class="mb-6 text-slate-700">La fiscalidad es una de las √°reas m√°s complejas y depende directamente de su perfil y de los servicios que preste. A continuaci√≥n se detallan los impuestos clave que le afectan. Explore cada uno para entender la base imponible, los tipos aplicables y los modelos de declaraci√≥n.</p>
                        <div id="taxes-grid" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                        </div>
                    </div>
                </section>
                
                <section id="sanciones" class="mb-8">
                     <h2 class="text-2xl font-bold text-slate-900 mb-4">Visualizaci√≥n del R√©gimen Sancionador</h2>
                      <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                        <p class="mb-4 text-slate-700">El incumplimiento de la normativa puede acarrear sanciones econ√≥micas muy elevadas. Este gr√°fico compara las cuant√≠as m√°ximas de las multas seg√∫n el tipo de infracci√≥n (leve, grave o muy grave) en las principales √°reas regulatorias. Es un recordatorio visual de la importancia de operar legalmente.</p>
                        <div class="chart-container">
                            <canvas id="sancionesChart"></canvas>
                        </div>
                    </div>
                </section>

                <section id="regulacion-autonomica" class="mb-8">
                    <h2 class="text-2xl font-bold text-slate-900 mb-4">Regulaci√≥n por Comunidad Aut√≥noma</h2>
                     <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                        <p class="mb-6 text-slate-700">La regulaci√≥n del alquiler tur√≠stico es competencia de las Comunidades Aut√≥nomas, y los Ayuntamientos pueden a√±adir limitaciones urban√≠sticas. Esto crea un mosaico normativo. Seleccione una comunidad para ver un resumen de sus requisitos y tendencias m√°s relevantes.</p>
                        <div class="flex flex-wrap gap-2 border-b border-slate-200 mb-4">
                            <button class="ccaa-tab tab-active px-4 py-2 text-sm font-medium border-b-2" data-ccaa="cataluna">Catalu√±a</button>
                            <button class="ccaa-tab px-4 py-2 text-sm font-medium border-b-2 border-transparent text-slate-500 hover:text-blue-600" data-ccaa="madrid">Madrid</button>
                            <button class="ccaa-tab px-4 py-2 text-sm font-medium border-b-2 border-transparent text-slate-500 hover:text-blue-600" data-ccaa="andalucia">Andaluc√≠a</button>
                            <button class="ccaa-tab px-4 py-2 text-sm font-medium border-b-2 border-transparent text-slate-500 hover:text-blue-600" data-ccaa="valenciana">C. Valenciana</button>
                            <button class="ccaa-tab px-4 py-2 text-sm font-medium border-b-2 border-transparent text-slate-500 hover:text-blue-600" data-ccaa="canarias">Canarias</button>
                        </div>
                        <div id="ccaa-content" class="p-4 bg-slate-50 rounded-lg">
                        </div>
                    </div>
                </section>

                <section id="checklist" class="mb-8">
                    <h2 class="text-2xl font-bold text-slate-900 mb-4">Checklist Interactivo de Cumplimiento</h2>
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                        <p class="mb-6 text-slate-700">Utilice esta lista de verificaci√≥n para autoevaluar su nivel de cumplimiento. Se basa en los errores m√°s frecuentes y las buenas pr√°cticas del sector, adapt√°ndose a su perfil seleccionado. Marque las casillas para asegurarse de que tiene todos los puntos clave cubiertos.</p>
                        <div id="checklist-container" class="space-y-4">
                        </div>
                    </div>
                </section>
                
                 <section id="glosario" class="mb-8">
                    <h2 class="text-2xl font-bold text-slate-900 mb-4">Glosario de T√©rminos Clave</h2>
                     <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                         <p class="mb-6 text-slate-700">El sector del alquiler tur√≠stico utiliza una terminolog√≠a legal y fiscal espec√≠fica. Esta secci√≥n le ayuda a entender los conceptos m√°s importantes. Utilice el buscador para encontrar r√°pidamente una definici√≥n.</p>
                        <input type="text" id="glossary-search" placeholder="Buscar t√©rmino (ej. LAU, VUT, IRPF)..." class="w-full p-3 border border-slate-300 rounded-lg mb-6 focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <div id="glossary-content" class="space-y-4 max-h-96 overflow-y-auto pr-2">
                        </div>
                    </div>
                </section>
                
            </div>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            
            const data = {
                persona_fisica: {
                    overview: "Como propietario particular, su principal desaf√≠o es distinguir si sus ingresos son rendimientos de capital inmobiliario o de actividades econ√≥micas, lo que afecta directamente a su IRPF y a la posible sujeci√≥n a IVA. La regulaci√≥n auton√≥mica y el registro de viajeros son obligaciones ineludibles.",
                    taxes: [
                        { name: "IRPF", desc: "Principal impuesto. Tributa como Rendimiento de Capital Inmobiliario (sin servicios hoteleros) o como Actividad Econ√≥mica (con servicios y personal).", details: "<strong>RCI:</strong> Ingresos - Gastos Deducibles. Sin reducci√≥n del 60%.<br><strong>Act. Econ√≥mica:</strong> Requiere personal contratado. M√°s gastos deducibles.<br><strong>Modelos:</strong> 100, 130 (si actividad), 210 (no residentes)." },
                        { name: "IVA", desc: "Generalmente exento si no se prestan servicios hoteleros. Si se prestan (limpieza diaria, recepci√≥n), est√° sujeto al 21%.", details: "<strong>Exento:</strong> Lo m√°s com√∫n. Sin factura con IVA.<br><strong>Sujeto al 21%:</strong> Requiere alta en Hacienda (Mod. 036), declaraciones trimestrales (Mod. 303) y resumen anual (Mod. 390)." },
                        { name: "IAE", desc: "Impuesto sobre Actividades Econ√≥micas. Exento si la cifra de negocio es < 1M‚Ç¨.", details: "Aunque exento de pago, es obligatorio darse de alta en el censo con el modelo 840/848 si se califica como actividad econ√≥mica." },
                        { name: "Otros", desc: "IBI, Plusval√≠a Municipal (al vender), ITP/AJD (al comprar)." }
                    ],
                    checklist: [
                        "He verificado la normativa urban√≠stica de mi municipio.",
                        "Tengo licencia o declaraci√≥n responsable presentada y vigente.",
                        "Mi n√∫mero de registro tur√≠stico figura en toda la publicidad.",
                        "Declaro correctamente los ingresos en el IRPF (como RCI o Act. Econ√≥mica).",
                        "Comunico los datos de todos los viajeros (>16 a√±os) a la Polic√≠a/Guardia Civil.",
                        "Tengo un contrato de alojamiento claro para los hu√©spedes.",
                        "Dispongo de hojas de reclamaciones oficiales.",
                        "Mi seguro del hogar cubre el uso como vivienda tur√≠stica."
                    ]
                },
                persona_juridica: {
                    overview: "Como sociedad, la actividad se presume siempre econ√≥mica. Esto implica obligaciones contables y fiscales m√°s complejas, incluyendo el Impuesto sobre Sociedades y, generalmente, la aplicaci√≥n de IVA al 21% sobre los alquileres.",
                    taxes: [
                        { name: "Impuesto sobre Sociedades (IS)", desc: "Tributa sobre el beneficio contable. El tipo general es del 25%.", details: "<strong>Base Imponible:</strong> Ingresos - Gastos deducibles.<br><strong>Tipo General:</strong> 25%.<br><strong>Modelos:</strong> 200 (anual), 202 (pagos fraccionados)." },
                        { name: "IVA", desc: "La actividad de alquiler tur√≠stico por una sociedad est√° sujeta y no exenta de IVA.", details: "<strong>Tipo:</strong> 21% a repercutir en factura al hu√©sped.<br><strong>Obligaciones:</strong> Declaraciones trimestrales (Mod. 303) y anuales (Mod. 390)." },
                        { name: "IAE", desc: "Obligatorio el pago si la cifra de negocio supera 1M‚Ç¨, pero siempre obligatorio el alta.", details: "El ep√≠grafe suele ser el 685 (Alojamientos tur√≠sticos extrahoteleros)." },
                        { name: "Otros", desc: "IBI, Plusval√≠a Municipal (al vender), ITP/AJD (al comprar)." }
                    ],
                    checklist: [
                        "La sociedad est√° dada de alta en el IAE correspondiente.",
                        "Se emiten facturas con el 21% de IVA a los hu√©spedes.",
                        "Se presenta el Impuesto sobre Sociedades (Mod. 200 y 202).",
                        "Se cumplen todas las obligaciones de registro y licencia tur√≠stica.",
                        "Se comunican los datos de los viajeros a la Polic√≠a/Guardia Civil.",
                        "Existe un contrato de encargado del tratamiento si una gestora externa maneja datos.",
                        "Se dispone de hojas de reclamaciones.",
                        "Se cumplen las obligaciones de prevenci√≥n de blanqueo de capitales si procede."
                    ]
                },
                gran_tenedor: {
                    overview: "Fiscalmente, se le aplican las reglas de persona f√≠sica o jur√≠dica seg√∫n corresponda. Su principal particularidad radica en las obligaciones adicionales de la Ley de Vivienda en 'zonas tensionadas', aunque esto afecta m√°s al alquiler de larga duraci√≥n.",
                    taxes: [
                         { name: "Fiscalidad Aplicable", desc: "La fiscalidad depende de si opera como persona f√≠sica o como sociedad.", details: "Consulte la pesta√±a de 'Propietario Persona F√≠sica' o 'Propietario Persona Jur√≠dica' para un desglose detallado de los impuestos correspondientes." },
                         { name: "Obligaciones Adicionales", desc: "M√°s all√° de lo fiscal, pueden existir obligaciones espec√≠ficas en materia de vivienda.", details: "En 'zonas de mercado residencial tensionado', la Ley de Vivienda puede imponer deberes de informaci√≥n y negociaci√≥n con inquilinos vulnerables, incluso si la vocaci√≥n principal es tur√≠stica." }
                    ],
                    checklist: [
                        "Identificar si alguno de mis inmuebles est√° en 'zona de mercado tensionado'.",
                        "Cumplir con las obligaciones fiscales del perfil correspondiente (f√≠sico o jur√≠dico).",
                        "Asegurar que toda la cartera de inmuebles tur√≠sticos tiene su licencia.",
                        "Tener un sistema centralizado para el registro de viajeros de todas las propiedades.",
                        "Gestionar de forma unificada las obligaciones de IVA e IS si opero como sociedad.",
                        "Evaluar la necesidad de un Delegado de Protecci√≥n de Datos (DPD) por el volumen de datos."
                    ]
                },
                empresa_gestora: {
                    overview: "Su rol es de intermediario y prestador de servicios. Sus obligaciones fiscales se centran en el IS por sus beneficios y el IVA por sus comisiones. Act√∫a como 'Encargado del Tratamento' de datos y puede ser 'Sujeto Obligado' en prevenci√≥n de blanqueo de capitales (PBC).",
                    taxes: [
                        { name: "Impuesto sobre Sociedades (IS)", desc: "Tributa por los beneficios de su actividad de gesti√≥n. Tipo general del 25%.", details: "<strong>Base Imponible:</strong> Comisiones y otros ingresos - Gastos de la actividad.<br><strong>Modelos:</strong> 200 (anual), 202 (pagos fraccionados)." },
                        { name: "IVA", desc: "Los servicios de gesti√≥n y las comisiones cobradas al propietario est√°n sujetos al 21% de IVA.", details: "Debe repercutir IVA al propietario por sus servicios.<br><strong>Modelos:</strong> 303 (trimestral), 390 (anual), 347 (operaciones con terceros)." },
                        { name: "Prevenci√≥n Blanqueo Capitales (PBC)", desc: "Son sujetos obligados. Deben aplicar medidas de diligencia debida.", details: "Obligaciones: Identificar clientes, analizar riesgo, comunicar operaciones sospechosas al SEPBLAC, conservar documentaci√≥n 10 a√±os." }
                    ],
                    checklist: [
                        "Tengo un contrato de 'Encargado del Tratamiento' firmado con cada propietario.",
                        "Aplico el 21% de IVA en las facturas de comisiones a los propietarios.",
                        "Cumplo con las obligaciones del Impuesto sobre Sociedades.",
                        "He implementado un manual y procedimientos de Prevenci√≥n de Blanqueo de Capitales (PBC).",
                        "Aseguro que todas las propiedades que gestiono tienen licencia y la publicitan.",
                        "Gestiono el registro de viajeros para mis clientes.",
                        "Facilito las hojas de reclamaciones en las propiedades gestionadas."
                    ]
                }
            };
            
            const ccaaData = {
                cataluna: {
                    title: "Catalu√±a: Regulaci√≥n Restrictiva",
                    content: "<ul><li class='mb-2'><strong>Licencia:</strong> Se requiere licencia municipal previa (no basta declaraci√≥n responsable).</li><li class='mb-2'><strong>Barcelona (PEAU):</strong> Prohibici√≥n de nuevas licencias en casi toda la ciudad y caducidad de las existentes.</li><li class='mb-2'><strong>Duraci√≥n:</strong> El alquiler tur√≠stico se limita a estancias inferiores a 31 d√≠as.</li><li class='mb-2'><strong>Requisitos:</strong> C√©dula de habitabilidad vigente y prohibici√≥n de conductas inc√≠vicas.</li></ul>"
                },
                madrid: {
                    title: "Madrid: Requisitos Urban√≠sticos Clave",
                    content: "<ul><li class='mb-2'><strong>Uso Terciario:</strong> Las VUT deben tener un uso terciario de hospedaje en el planeamiento urban√≠stico, lo que las inhabilita en la mayor√≠a de edificios residenciales.</li><li class='mb-2'><strong>Acceso Independiente:</strong> Requisito de acceso independiente desde la calle, no por el portal com√∫n de los vecinos.</li><li class='mb-2'><strong>Certificado Idoneidad (CIVUT):</strong> Necesario para obtener el registro.</li><li class='mb-2'><strong>Tendencia:</strong> Muy restrictiva para nuevas aperturas, con miles de expedientes de cese de actividad.</li></ul>"
                },
                andalucia: {
                    title: "Andaluc√≠a: Flexibilidad con Control Comunitario",
                    content: "<ul><li class='mb-2'><strong>Procedimiento:</strong> Se inicia la actividad con la presentaci√≥n de una Declaraci√≥n Responsable.</li><li class='mb-2'><strong>Comunidades de Propietarios:</strong> Pueden prohibir o limitar la actividad por mayor√≠a de 3/5 partes.</li><li class='mb-2'><strong>Requisitos:</strong> Climatizaci√≥n (fr√≠o/calor) obligatoria, botiqu√≠n, tel√©fono 24h.</li><li class='mb-2'><strong>Tendencia:</strong> Creciente restricci√≥n a nivel municipal (Sevilla, M√°laga) y por parte de las comunidades.</li></ul>"
                },
                valenciana: {
                    title: "Comunidad Valenciana: El Filtro Urban√≠stico",
                    content: "<ul><li class='mb-2'><strong>Compatibilidad Urban√≠stica:</strong> Imprescindible un informe favorable del Ayuntamiento para poder presentar la declaraci√≥n responsable.</li><li class='mb-2'><strong>Valencia Ciudad:</strong> Normas muy restrictivas que limitan las licencias a bajos y primeras plantas, o las proh√≠ben en zonas saturadas.</li><li class='mb-2'><strong>Comunidades de Propietarios:</strong> Tambi√©n pueden prohibir o limitar la actividad.</li><li class='mb-2'><strong>Seguro RC:</strong> Obligatorio.</li></ul>"
                },
                canarias: {
                    title: "Canarias: Regulaci√≥n en Transici√≥n",
                    content: "<ul><li class='mb-2'><strong>Procedimiento:</strong> Se inicia con Declaraci√≥n Responsable.</li><li class='mb-2'><strong>Inestabilidad Normativa:</strong> El decreto de 2015 fue parcialmente anulado por los tribunales. Un nuevo decreto est√° en tramitaci√≥n para dar mayor seguridad jur√≠dica.</li><li class='mb-2'><strong>Exclusiones:</strong> La regulaci√≥n inicial exclu√≠a suelos tur√≠sticos, pero esto fue anulado judicialmente.</li><li class='mb-2'><strong>Tendencia:</strong> Expectante ante la nueva normativa, que previsiblemente dar√° m√°s poder de ordenaci√≥n a cabildos y ayuntamientos.</li></ul>"
                }
            };
            
            const glossaryData = {
                "LAU": "Ley de Arrendamientos Urbanos. Regula los alquileres de vivienda habitual y de temporada, pero excluye el alquiler tur√≠stico si este est√° regulado por la normativa sectorial.",
                "VUT": "Vivienda de Uso Tur√≠stico. Denominaci√≥n legal de las viviendas que se ceden temporalmente, con fines tur√≠sticos, a cambio de un precio.",
                "Declaraci√≥n Responsable": "Documento por el que el interesado manifiesta que cumple los requisitos para iniciar una actividad. Permite comenzar a operar de inmediato, bajo posterior inspecci√≥n.",
                "Licencia Urban√≠stica": "Permiso municipal que autoriza un determinado uso del suelo (en este caso, tur√≠stico). Es un procedimiento m√°s largo y restrictivo que la declaraci√≥n responsable.",
                "IRPF": "Impuesto sobre la Renta de las Personas F√≠sicas. Grava los ingresos de los particulares. En alquiler tur√≠stico, pueden ser rendimientos de capital inmobiliario o de actividad econ√≥mica.",
                "IVA": "Impuesto sobre el Valor A√±adido. Grava el consumo. En alquileres tur√≠sticos, generalmente est√° exento para particulares sin servicios hoteleros, pero es obligatorio (21%) para sociedades o si se prestan dichos servicios.",
                "IS": "Impuesto sobre Sociedades. Grava los beneficios de las empresas. Tipo general del 25%.",
                "IAE": "Impuesto sobre Actividades Econ√≥micas. Grava la actividad empresarial. Personas f√≠sicas y sociedades con facturaci√≥n <1M‚Ç¨ est√°n exentas de pago, pero no de alta.",
                "PEAU": "Plan Especial de Alojamientos Tur√≠sticos. Plan urban√≠stico de Barcelona que restringe severamente las VUT.",
                "PEUAH": "Plan Especial de Usos de Hospedaje. Plan urban√≠stico de Madrid que exige uso terciario y acceso independiente a las VUT.",
                "SEPBLAC": "Servicio Ejecutivo de la Comisi√≥n de Prevenci√≥n del Blanqueo de Capitales e Infracciones Monetarias. La unidad de inteligencia financiera de Espa√±a.",
                "RAT": "Registro de Actividades de Tratamiento. Documento interno obligatorio bajo el RGPD que detalla los tratamientos de datos personales que realiza una organizaci√≥n.",
                "Encargado del Tratamiento": "Persona o entidad que trata datos personales por cuenta del responsable (ej. una gestora que trata datos de los hu√©spedes en nombre del propietario)."
            };

            let currentState = { actor: 'persona_fisica', ccaa: 'cataluna' };

            const actorButtons = document.querySelectorAll('.actor-btn');
            const ccaaTabs = document.querySelectorAll('.ccaa-tab');
            const overviewText = document.getElementById('overview-text');
            const taxesGrid = document.getElementById('taxes-grid');
            const checklistContainer = document.getElementById('checklist-container');
            const ccaaContent = document.getElementById('ccaa-content');
            const glossaryContent = document.getElementById('glossary-content');
            const glossarySearch = document.getElementById('glossary-search');

            function updateView() {
                const actorData = data[currentState.actor];
                
                actorButtons.forEach(btn => {
                    btn.classList.toggle('actor-btn-active', btn.dataset.actor === currentState.actor);
                });

                overviewText.innerHTML = actorData.overview;
                
                taxesGrid.innerHTML = '';
                actorData.taxes.forEach(tax => {
                    const taxCard = document.createElement('div');
                    taxCard.className = 'bg-slate-50 p-4 rounded-lg border border-slate-200';
                    taxCard.innerHTML = `
                        <h4 class="font-semibold text-blue-700">${tax.name}</h4>
                        <p class="text-sm text-slate-600 mt-1 mb-2">${tax.desc}</p>
                        ${tax.details ? `<details><summary class="text-sm font-medium text-blue-600 cursor-pointer details-marker">M√°s detalles</summary><p class="mt-2 text-xs text-slate-500 bg-white p-2 rounded">${tax.details}</p></details>` : ''}
                    `;
                    taxesGrid.appendChild(taxCard);
                });

                checklistContainer.innerHTML = '';
                actorData.checklist.forEach((item, index) => {
                    const checkItem = document.createElement('div');
                    checkItem.className = 'flex items-start';
                    checkItem.innerHTML = `
                        <input id="check-${index}" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500 mt-1">
                        <label for="check-${index}" class="ml-3 text-sm text-slate-700">${item}</label>
                    `;
                    checklistContainer.appendChild(checkItem);
                });
                
                updateCcaaView();
            }
            
            function updateCcaaView() {
                const ccaaInfo = ccaaData[currentState.ccaa];
                ccaaTabs.forEach(tab => {
                    tab.classList.toggle('tab-active', tab.dataset.ccaa === currentState.ccaa);
                    if(tab.dataset.ccaa !== currentState.ccaa) {
                        tab.classList.remove('text-blue-600', 'bg-blue-50');
                        tab.classList.add('text-slate-500');
                    }
                });
                ccaaContent.innerHTML = `
                    <h4 class="font-semibold text-lg mb-2 text-slate-800">${ccaaInfo.title}</h4>
                    <div class="text-sm text-slate-600 space-y-2">${ccaaInfo.content}</div>
                `;
            }

            actorButtons.forEach(button => {
                button.addEventListener('click', () => {
                    currentState.actor = button.dataset.actor;
                    updateView();
                });
            });
            
            ccaaTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    currentState.ccaa = tab.dataset.ccaa;
                    updateCcaaView();
                });
            });
            
            function populateGlossary(filter = '') {
                glossaryContent.innerHTML = '';
                const filteredKeys = Object.keys(glossaryData).filter(key => key.toLowerCase().includes(filter.toLowerCase()));
                
                if (filteredKeys.length === 0) {
                     glossaryContent.innerHTML = `<p class="text-sm text-slate-500">No se encontraron resultados.</p>`;
                     return;
                }

                filteredKeys.forEach(key => {
                    const termDiv = document.createElement('div');
                    termDiv.innerHTML = `
                        <details class="group">
                            <summary class="flex justify-between items-center font-semibold text-slate-800 cursor-pointer list-none">
                                <span>${key}</span>
                                <span class="transition group-open:rotate-180">
                                    <svg fill="none" height="24" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="24"><path d="M6 9l6 6 6-6"></path></svg>
                                </span>
                            </summary>
                            <p class="text-slate-600 mt-2 group-open:animate-fadeIn text-sm">${glossaryData[key]}</p>
                        </details>
                    `;
                    glossaryContent.appendChild(termDiv);
                });
            }

            glossarySearch.addEventListener('input', (e) => {
                populateGlossary(e.target.value);
            });


            const sancionesCtx = document.getElementById('sancionesChart').getContext('2d');
            const sancionesChart = new Chart(sancionesCtx, {
                type: 'bar',
                data: {
                    labels: ['Turismo', 'Consumo', 'Protecci√≥n Datos'],
                    datasets: [
                        {
                            label: 'Leve (‚Ç¨)',
                            data: [3000, 3000, 40000],
                            backgroundColor: 'rgba(59, 130, 246, 0.5)',
                            borderColor: 'rgba(59, 130, 246, 1)',
                            borderWidth: 1
                        },
                        {
                            label: 'Grave (‚Ç¨)',
                            data: [90000, 45000, 10000000], 
                            backgroundColor: 'rgba(245, 158, 11, 0.5)',
                            borderColor: 'rgba(245, 158, 11, 1)',
                            borderWidth: 1
                        },
                        {
                            label: 'Muy Grave (‚Ç¨)',
                            data: [900000, 600000, 20000000],
                            backgroundColor: 'rgba(239, 68, 68, 0.5)',
                            borderColor: 'rgba(239, 68, 68, 1)',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            type: 'logarithmic',
                            beginAtZero: true,
                            ticks: {
                                callback: function(value, index, values) {
                                    if (value === 1000000000) return '1B';
                                    if (value === 100000000) return '100M';
                                    if (value === 20000000) return '20M';
                                    if (value === 10000000) return '10M';
                                    if (value === 1000000) return '1M';
                                    if (value === 100000) return '100k';
                                    if (value === 10000) return '10k';
                                    if (value === 1000) return '1k';
                                    return null;
                                },
                                 color: '#475569'
                            },
                            grid: {
                                color: '#e2e8f0'
                            }
                        },
                        x: {
                             ticks: {
                                color: '#475569'
                            },
                            grid: {
                                display: false
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                             labels: {
                                color: '#1e293b'
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.y !== null) {
                                        label += new Intl.NumberFormat('es-ES', { style: 'currency', currency: 'EUR' }).format(context.parsed.y);
                                    }
                                    return label;
                                }
                            }
                        }
                    }
                }
            });

            document.getElementById('update-date').textContent = new Date().toLocaleDateString('es-ES', { day: '2-digit', month: '2-digit', year: 'numeric' });

            updateView();
            populateGlossary();
        });
    </script>
</body>
</html>
